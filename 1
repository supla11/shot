CREATE DATABASE IF NOT EXISTS CollegeDB;
USE CollegeDB;

DROP TABLE IF EXISTS Students;
CREATE TABLE Students (
  id INT PRIMARY KEY,
  name VARCHAR(30),
  marks INT
);

INSERT INTO Students VALUES
(1, 'Amit', 80),
(2, 'Riya', 92),
(3, 'Raj', 76),
(4, 'Sneha', 88);

DELIMITER //
CREATE PROCEDURE implicit_cursor()
BEGIN
  DECLARE v_name VARCHAR(30);
  DECLARE v_marks INT;
  SELECT name, marks INTO v_name, v_marks FROM Students WHERE id = 1;
  SELECT CONCAT('Implicit Cursor → ', v_name, ' scored ', v_marks) AS Result;
END;
//
DELIMITER ;

DELIMITER //
CREATE PROCEDURE explicit_cursor()
BEGIN
  DECLARE done INT DEFAULT 0;
  DECLARE v_name VARCHAR(30);
  DECLARE v_marks INT;
  DECLARE stu_cur CURSOR FOR SELECT name, marks FROM Students;
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
  OPEN stu_cur;
  read_loop: LOOP
    FETCH stu_cur INTO v_name, v_marks;
    IF done THEN LEAVE read_loop; END IF;
    SELECT CONCAT('Explicit Cursor → ', v_name, ' : ', v_marks) AS Result;
  END LOOP;
  CLOSE stu_cur;
END;
//
DELIMITER ;

DELIMITER //
CREATE PROCEDURE cursor_for_loop()
BEGIN
  DECLARE done INT DEFAULT 0;
  DECLARE v_name VARCHAR(30);
  DECLARE v_marks INT;
  DECLARE cur CURSOR FOR SELECT name, marks FROM Students;
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
  OPEN cur;
  loop1: LOOP
    FETCH cur INTO v_name, v_marks;
    IF done THEN LEAVE loop1; END IF;
    SELECT CONCAT('FOR Loop Cursor → ', v_name, ' got ', v_marks) AS Result;
  END LOOP;
  CLOSE cur;
END;
//
DELIMITER ;

DELIMITER //
CREATE PROCEDURE parameterized_cursor(IN min_marks INT)
BEGIN
  DECLARE done INT DEFAULT 0;
  DECLARE v_name VARCHAR(30);
  DECLARE v_marks INT;
  DECLARE cur CURSOR FOR SELECT name, marks FROM Students WHERE marks > min_marks;
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
  OPEN cur;
  read_loop: LOOP
    FETCH cur INTO v_name, v_marks;
    IF done THEN LEAVE read_loop; END IF;
    SELECT CONCAT('Parameterized Cursor → ', v_name, ' scored ', v_marks, ' (> ', min_marks, ')') AS Result;
  END LOOP;
  CLOSE cur;
END;
//
DELIMITER ;

CALL implicit_cursor();
CALL explicit_cursor();
CALL cursor_for_loop();
CALL parameterized_cursor(80);
